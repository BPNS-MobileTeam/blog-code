# 2020 회고

상반기/하반기가 아닌 1년 전체 회고

## 1. 회사

### 1-1. 신규 시스템 오픈

매입 (acquire) 시스템을 오픈했다.  
신규 시스템을 오픈하게 된 이유는 크게 2가지였다.  

1. 주문-정산 사이의 회색 지대만 담당할 시스템 필요성
2. 정산시스템의 망분리 환경

사건(?)의 발단은 점점 다양한 형태의 업주님들의 매출정보가 필요하다보니 주문시스템과 정산시스템이 실제 집중해야할 일 보다 **데이터 뽑아주는 일**이 계속 발생했던 것이다.  
  
* 주문시스템은 고객분들의 주문이 원할하게 하는 것에 집중을 해야하고
* 정산시스템은 업주님들께 빠르고 정확하게 정산을 해줘야하는 것에 집중을 해야하는데

그 외 **나머지 일들에 자꾸 업무 리소스가 사용**되는 것이였다.  
  
다양한 형태의 매출 정보, 회계감사용 데이터 제공, 신규 오픈되는 여러 업주향 서비스들에 제공될 API등 시스템 본연의 일 보다는 외부 지원에만 리소스가 다 사용되는 것이다.  
  
그러다보니 주문시스템은 주문시스템 나름대로 매번 신규 데이터 연동 포맷을 고민하게 되고, 외부 지원만 하고, 정산시스템은 엑셀 데이터를 뽑거나 자주 요청오는건은 어드민에 엑셀 기능을 추가하는 등의 일들이 자꾸 추가되게 되었다.  
  
그래서 이렇게 주문건당 필요한 요청에 대해서만 집중할 수 있는 별개의 시스템이 필요하다고 판단되었다.  
  
물론 이에 대한 해결책이 신규 시스템을 만드는 것인가? 하는 생각도 있었다.  
그냥 정산시스템이 계속 진행하면되지않나? 것이다.  
  
근데 그러기엔 너무나 어려웠던 것이,

* 정산시스템은 일단 주문 원천 데이터를 사용하지 않고 이미 가공된 데이터를 저장하고 관리중이고
* 정산에 포함되지 않는 데이터 (앱내 결제가 아닌 만나서결제로 하여 업주님들이 돈을 직접 수령해가시는 경우)는 정산시스템은 연동 받지 않았고
* 가장 큰 이유는 정산시스템은 **망분리 환경**이였다.

이 망분리 환경이 정말 큰 이슈인데,  
주문 데이터는 망분리 대상이 아니지만, 정산 데이터는 망분리 대상이다.  
경험해본 사람들은 알겠지만, 망분리 환경은 정말 개발자들의 생산성을 저하시킨다.  
더 큰 문제는 **정산 시스템에 접근하는 모든 행위가 관리대상에 포함**된다.  
그래서 타 팀이 정산 시스템의 어드민이라도 접근하려면 수많은 권한요청과 프로세스를 거쳐야하고, **망분리용 접근 노트북**을 사용해야만 한다.  
  
이 회색지대의 데이터는 실상은 주문 데이터임에도, 정산시스템이 제공해야하는 순간 그 수많은 프로세스를 거쳐야되는 것이다.  
  
그래서 이 회색지대는 망분리 환경에서 벗어나서 다뤄야만 된다는 판단에 신규 시스템을 구축하게 되었다.  
  
기존의 정산시스템을 운영하고 전사 프로젝트들도 진행해야되서, 가장 편한 스택으로 빠르게 오픈하고 검수 과정을 거쳤다.  
대략 3개월간 빠르게 API/어드민/배치 등을 모두 구현해서 오픈한 이후, 3개월간 데이터 검수를 계속 진행했다.  
  
한번 잘못 데이터가 꼬이면 매일 수백만건씩 발생하는 주문데이터 사이에서 그 1건을 찾는게 너무 어렵기 때문에 개발 시간 보다 검수시간에 더 많은 리소스를 투입될 수 밖에 없었다.  
  
기회가 되면 이 시스템 오픈과정도 이전 [포인트 시스템 오픈](https://woowabros.github.io/experience/2018/10/12/new_point_story_1.html)처럼 소개해보면 좋겠다 싶었는데, 이건 기회가 되면 별도로 정리해볼 계획이다.

> 물론 이렇게 오픈한 신규 시스템은 정산시스템이 AWS로 이관되면서 살짝 애매해졌는데, AWS 이관 이야기는 아래에서 좀 더 자세히 이야기하겠다.

### 1-2. 오픈 서비스 오픈과 롤백

아래 표를 보면 알겠지만, 일반적으로 전체 

(회사가 아닌) 내 개인의 입장에서는 우리 서비스의 고객은 총 3분이다.

* 주문을 해주시는 회원분들
* 음식을 파시는 업주분들
* 음식을 배달하시는 라이더분들

이게 진짜 어렵다고 보는게, 1개의 주문이 발생했을 때 이 3분을 다 만족할 수 있는 비지니스 모델이라는게 있을까?

* 고객분들은 더 할인된 가격에 음식을 드시고 싶고,
* 업주님들은 더 많은 이윤을 남겨서 음식을 팔고 싶으시고,
* 라이더분들은 배달 1건당 더 많은 배달료를 받고 싶으시다.

그래서 오로지 고객분들을 위해 모든걸 한다는 것은 나머지 업주님들과 라이더분들에 드리는 혜택을 빼올 수 밖에 없다.  
  
왜 그러냐면, 거의 대부분의 주문은 배달의 민족에서 발생하는데 (배민 라이더스는 전체 주문의 1/10도 안된다.) 아래 표를 보면 알겠지만, **주문 건당 발생하는 수수료가 없다**.

![servicefee](./images/servicefee.jpeg)

([머니투데이 기사](https://news.mt.co.kr/mtview.php?no=2020081915381945802))  
  
90%이상의 주문이 발생하는 배달의 민족에서 주문 건당 발생하는 수수료가 없으니 쿠폰이벤트/포인트등은 사실상 손실을 감수하고 가야만 한다.

### 1-3. 광고비 지원 체계 오픈

배달업계에서는 유일하게 우리 회사만 이런 광고비 


3월/4월/8월/12월 등 수백억원을 광고비 지원을 했다.  
(정확한 수치는 공개해도 될지 몰라서 일단 3/4월 뉴스로 공개된 것만 올렸다.)

### 1-4. 정산시스템 전반적인 쿼리 튜닝

2020년 상반기부터 어드민과 배치에서 요청당 몇분씩 걸리는 쿼리가 하나둘씩 발생하기 시작했다.  
이미 주요 테이블들의 데이터가 3억건씩 돌파한 상태였기 때문에 당연한 일이였다.  


> 아래에서 좀 더 자세히 후술하겠지만 이때의 개선 사례를 [컨퍼런스에서 발표](https://www.youtube.com/watch?v=zMAX7g6rO_Y)를 하였다.

### AWS 마이그레이션

### 기술 블로그와 채용 노션

[기술블로그](https://woowabros.github.io/experience/2020/02/05/springbatch-querydsl.html)와 [팀 채용 노션](https://www.notion.so/jojoldu/5badc2ba03904832bce8fdf3dc4a407b)

### 능력자 팀원의 퇴사


### 역대 최고 주문수 달성

2020년을 마무리하는 12월 31일, 배달의민족 (배민라이더스와 포장주문 제외한 순수 배달의 민족으로만)의 **앱 내 결제**가 하루 최대치인 **310만 건**을 돌파했다.  
(만나서 결제도 수십만건이다보니 배민라이더스, 포장주문 제외하고 배달의 민족으로만 350만건을 넘는다.)  
  
배달의 민족은 타 서비스와 달리 **주문 건당 발생하는 수수료가 없다**.  
**월 광고료가 전부**다.  
(배달의 민족의 경우 배달료도 회사가 수취하지 않고, 업주님들의 몫이다. 배달의민족은 주문을 중계만 하고, 배달은 업주님들이 직접 하시거나 배달 대행업체를 사용하시기 때문이다.)  
  
즉, 주문이 아무리 많이 발생해도 회사의 매출이 증가하진 않는 서비스이다.  

> 결제수수료는 어차피 PG사에 전달하기 때문에 실제 회사에 남는게 없다.

그럼에도 배달이라는 도메인에서 하루 주문수가 310만이 된다는 것은 백엔드 개발자로서 감회가 새롭다.  
  
하루 500만건을 연동하고 정산하는 날도 금방 오지 않을까? 하는 생각이 들었다.

## 2. 블로그

### 2-1. 68개의 글

상반기: 30개
하반기: 38개

* 1월: 2
* 2월: 8
* 3월: 9
* 4월: 4
* 5월: 5
* 6월: 2
* 7월: 8
* 8월: 7
* 9월: 5
* 10월: 3
* 11월: 7
* 12월: 8

![blogpv0](./images/blogpv0.png)

> 여담인데, 월별 발행수
 
### 2-2. 400만 PV 달성

GA 기준으로는 그 전에 돌파를 했는데, 그래도 블로그 공식 지표도 400만을 넘기는게 중요할것 같아서 11월 20일을 기준으로 하게 되었다.  
  
2019년 3월에 100만 돌파
2019년 11월에 200만 돌파
2020년 11월에 400만 돌파

1년만에 200만 PV가 증가되었다.  
거의 6개월에 100만씩 증가하는 셈인데, 솔직히 깜짝 놀라긴했다.  


![blogpv1](./images/blogpv1.png)

![blogpv2](./images/blogpv2.png)

PV와 애드센스의 비율은 1만PV당 $9 정도 되는 듯 하다.  
(환율따지면 PV 1당 1원인 셈이다.)

![adsense](./images/adsense.png)

즉, 년 200만 PV가 발생하는 IT 블로그는 1년에 약 200만원의 블로그 광고 수익이 발생한다는 것이다.  
12개월로 나누면 1개월에 16만원정도 되는 셈이다.  
  
한번 포스팅 써놓은 것들이 있으니 꾸준히 방문자가 유입될것같지만, 유튜브와 마찬가지로 구글 검색엔진 역시 **계속해서 신규 글을 발행하지 않으면 검색 노출이 뒤로 밀린다**.  
즉, 계속해서 글을 쓰지 않으면 현재의 조회수가 금방 사라진다는 것이다.  

꼭 광고 수익때문에 글을 쓰는건 아니기 때문에, 꾸준히 글 쓰는데 문제 될 것은 없다. 

> 블로그 400만 회고는 별도의 글로 정리할 예정이다.

## 3. 오픈소스

### Spring Batch Querydsl


[spring-batch-querydsl](https://github.com/jojoldu/spring-batch-querydsl)

## 4. 외부 활동

### Yes24 올해의 IT Top8 & 리디 주간 1등

![yes24](./images/yes24.jpeg)

[2020 Yes24 IT연말결산](http://www.yes24.com/campaign/01_book/yesPresent/yesPresent.aspx?EventNo=193729&CategoryNumber=001)

![ridi](./images/ridi.png)

### 발표

#### 이노콘 - OKKY 커뮤니티 소개

[이노베이션 아카데미 컨퍼런스 (이하 이노콘)](https://youtu.be/Tp9w7TatzJQ?list=PLdaJq4f37m1p-0EEXIO7JDb3xXhlluWC4&t=25662)에서 OKKY 운영진으로 커뮤니티 소개를 하는 촬영을 가졌다.

> 이노콘 전체 세션도 재밌지만, 사내 프론트엔드 개발리더이신 김민태님이 참여한 ["선배 개발자들이 말하는 실제 취업 현장과 개발문화"](https://www.youtube.com/watch?v=Tp9w7TatzJQ&list=PLdaJq4f37m1p-0EEXIO7JDb3xXhlluWC4&index=1) 세션은 취준생이라면 꼭 보길 추천한다.  
> (06:01:30부터다)

![okky1](./images/okky1.png)

(07:07:42부터 OKKY 커뮤니티 소개 시작이다.)

> 이 촬영이 끝나고 OKKY 10주년 행사 촬영이 있었는데, 그건 아직 영상이 안나와서 내년 상반기 회고때 자세히 쓸 예정이다.

#### JetBrains Productivity Day

[온/오프라인 인플루언서와 함께하는 IntelliJ IDEA와 생산성에 대한 이야기](https://www.youtube.com/watch?v=FCa4bTUowTY)

#### 우아콘


[수십억건에서 Querydsl 활용하기](https://www.youtube.com/watch?v=zMAX7g6rO_Y)

### 코디미

![coordime](./images/coordime.png)

[코디미](https://www.coordime.com/)

## 5. 기타

### 5-1. 작업실

### 5-2. 몸과 지갑의 다이어트

![oatmeal](./images/oatmeal.png)

Salt Swag 이라는 단어를 

### 5-3. 카페인 없이 살기

위에서 `Salt Swag` 을 하면서 또 뭐를 줄일까 보다가 내가 하루에 마시는 커피의 양이 어마하게 많다는 걸 깨닫게 됐다.  
아침/점심을 매번 벤티 사이즈로 마시고 있었던 것이다.  
  
돈을 떠나서 하루에 습관처럼 커피를 마시는 모습을 보고 "조금 위험한것 같은데?" 라는 생각을 했다.  
그러다 호돌맨님의 페이스북 글을 보고나서 진짜 끊어야겠다고 생각했다.

![coffee-fb](./images/coffee-fb.png)

하루에 1200ml 씩 커피를 마시던 사람이 한방에 끊을 수는 없었다.  

그래서 2단계로 나눠서 진행했다.  

1) 콜드브루 -> 디카페인 커피로 변경
2) 디카페인에서 -> 물로 변경 

디카페인은 일반 커피숍에서 팔지도 않고, 내가 마시던 양이 워낙 많아서 비용이 너무 크다는 생각을 했다.  
그래서 스마트스토어에서 원액을 그대로 파는 곳을 발견해서 거기서 원액을 주문하고 작업실 출근마다 하루 먹을양을 채워서 갔다.

[네이버 스마트 스토어](https://smartstore.naver.com/amolente/products/4857968316)

![coffee](./images/coffee.png)




## 6. 교육

![datapipeline1](./images/datapipeline1.png)

## 7. 내년 1분기 목표

## 8. 마무리

목표를 두진 않는데, 판단의 기준은 갖고 있다.  
보통 선택지 A와 B 둘다 좋은 경우 **하나를 위해 나머지를 버려야 하는 고통**이 있는데, 이때 무엇을 버릴지에 대한 최소한의 기준이 있어야 한다고 생각한다.  
  
나한테는 그게 "어른이 되었을때 얼마나 다양한 이야기를 해줄 수 있는가" 가 판단 기준이다.  
