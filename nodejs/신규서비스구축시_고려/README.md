# 신규 서비스 구축시 고려 사항 (feat. Node.js)

## 애플리케이션

* 비지니스 시간과 시스템 시간을 분리한다
  * 이를테면 `createdAt`, `updatedAt`, `deletedAt` 등 Entity의 변경에 대한 내용은 실제 데이터베이스에 반영된 시간을 사용하되 (`@CreateDateColumn`, `@UpdateDateColumn` 등)
  * 비지니스 시간은 **애플리케이션에서 만든 시간**을 사용한다.
    * ex) 결제시간, 주문시간, 영상실행시간 등은 Controller와 같이 첫 Layer에서 시간을 만들어 service/repository/domain이 모두 같은 시간을 가지도록 한다.

## 데이터베이스

* View는 사용하지 않는다.
  * 성능상 불이익이 있을때가 더 많다.
    * 실제 대상이 되는 대상보다 훨씬 더 많은 대상을 조회해서 view에 담는 과정이 필요하기 때문 (limit 10이 필요한데, 일단 view상에는 limit 없이 다 조회후 limit이 적용)
  * 성능 개선이 쉽지 않다.
    * 테이블 인덱스 외에도 view index를 추가로 사용해야만 한다
    * view 데이터 그대로 쓰는게 아니라, 추가 가공 (group by, limit, order by) 이들어가서 실제로 커버링 인덱스를 비롯한 제대로 된 인덱스 설계가 쉽지 않다
  * 코드상으로 이 쿼리가 무엇을 나타내는지 다 볼 수 있어야 한다.
* 테이블의 Enum은 사용하지 않는다.
  *  enum 항목들의 순서 변경이 발생하는 순간 엄청난 마이그레이션을 수행해야한다. 
  *  그에 비해 성능 향상은 그리 크지 않아보인다.
* `NOW()`, `PASSWORD()` 등 SQL에서 데이터를 생성하지 않는다
	* 데이터 생성/변형은 애플리케이션에서 일관되게 처리한다. 그렇지 않으면 추후 확장시 문제요소가 될 수 있다.
    * Datastore를 MongoDB로 전환해야하는 경우 
    * DB의 타임존이 KST가 아니라 UTC로 되어있는 경우 
    * 대량의 요청이 올 경우 애플리케이션 서버만 확장해서 해결이 안되는등 (결국 수십대 서버가 모두 데이터베이스에서 로직을 수행 요청하게 되니 DB 부담이 몰린다)